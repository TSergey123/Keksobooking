(()=>{var e={772:()=>{const e=["jpg","jpeg","png"],t=document.querySelector(".ad-form-header__input"),o=document.querySelector(".ad-form-header__preview-image");t.addEventListener("change",(()=>{const r=t.files[0],n=r.name.toLowerCase();if(e.some((e=>n.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{o.src=e.result})),e.readAsDataURL(r)}}));const r=document.querySelector(".ad-form__input"),n=document.querySelector(".ad-form__photo");r.addEventListener("change",(()=>{const t=r.files[0],o=t.name.toLowerCase();if(e.some((e=>o.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{const t=document.createElement("img");n.appendChild(t),t.alt="Фотография жилья",t.width="70",t.height="70",t.src=e.result})),e.readAsDataURL(t)}}))}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}(()=>{"use strict";document.querySelector("#card").content.querySelector(".popup").cloneNode(!0);const e={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},t=e=>{const t=window.L.map("map-canvas"),o=document.createElement("div");o.style.zIndex=100,o.style.backgroundColor="red",o.style.zIndex=100,o.style.position="absolute",o.style.left=0,o.style.right=0,o.style.top="50%",o.style.marginLeft="auto",o.style.padding="10px 3px",o.style.fontSize="30px",o.style.textAlign="center",o.textContent=e,t.append(o),setTimeout((()=>{o.remove()}),5e3)},r=document.querySelector("#success").content.querySelector(".success"),n=document.querySelector("#error").content.querySelector(".error"),a=e=>{(e=>"Escape"===e.key||"Esc"===e.key)(e)&&(e.preventDefault(),l())},c=e=>{e.preventDefault(),l()},s=e=>{document.body.appendChild(e),e.style.zIndex="9999",document.addEventListener("click",c),document.addEventListener("keydown",a)},l=()=>{document.querySelectorAll(".success, .error").forEach((e=>e.remove())),document.removeEventListener("click",c),document.removeEventListener("keydown",a)},u=35.712977129360546,i=139.7540842153831,d=u.toFixed(5)+", "+i.toFixed(5),p=document.querySelector(".ad-form__reset"),m=window.L.map("map-canvas"),y=(e,t,o,r)=>window.L.marker({lat:e,lng:t},{draggable:o,icon:r}),f=()=>{h.setLatLng([u,i]),m.setView(new window.L.LatLng(u,i),10)},h=y(u,i,!0,window.L.icon({iconUrl:"img/main-pin.svg",iconSize:[46,46],iconAnchor:[23,46]}));p.addEventListener("click",(()=>{f()}));const v=[],g=t=>{t.slice(0,10).forEach((t=>{const o=(r=t.location.lat,n=t.location.lng,y(r,n,!1,window.L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}))).addTo(m).bindPopup((()=>(t=>{const o=document.querySelector("#card").content.querySelector(".popup").cloneNode(!0);return o.querySelector(".popup__title").textContent=t.offer.title,o.querySelector(".popup__text--address").textContent=t.offer.address,o.querySelector(".popup__text--price").textContent=t.offer.price+"₽/ночь",o.querySelector(".popup__type").textContent=e[t.offer.type],o.querySelector(".popup__text--capacity").textContent=t.offer.rooms+" комнаты для "+t.offer.guests+" гостей",o.querySelector(".popup__text--time").textContent="Заезд после "+t.offer.checkin+" выезд до "+t.offer.checkout,o.querySelector(".popup__description").textContent=t.offer.description,o.querySelector(".popup__avatar").src=t.author.avatar,o.querySelector(".popup__photos").removeChild(o.querySelector(".popup__photo")),o.querySelector(".popup__photos").appendChild(function(e){const t=document.createDocumentFragment();for(let o=0;o<e.offer.photos.length;o++){const r=document.querySelector("#card").content.querySelector(".popup").querySelector(".popup__photo").cloneNode(!0);r.src=e.offer.photos[o],t.appendChild(r)}return t}(t)),o.querySelector(".popup__features").innerHTML="",o.querySelector(".popup__features").appendChild(function(e){const t=document.createDocumentFragment();for(let o=0;o<e.offer.features.length;o++){const r=document.createElement("li");r.className="popup__feature popup__feature--"+e.offer.features[o],t.appendChild(r)}return t}(t)),o})(t)));var r,n;v.push(o)}))},S=document.querySelector(".ad-form"),q=S.querySelector("#type"),_=S.querySelector("#address"),L=S.querySelector("#title"),w=S.querySelector("#price"),E=S.querySelector("#timein"),x=S.querySelector("#timeout"),C=S.querySelector("#room_number"),b=S.querySelector("#capacity"),k=S.querySelectorAll("fieldset"),A=document.querySelector(".map__filters"),V=A.querySelectorAll("select"),D=A.querySelectorAll("fieldset"),F=document.querySelector(".ad-form"),T=()=>{const e=Number(C.value),t=b.value;100===e&&"0"!==t?b.setCustomValidity('Выберите вариант "Не для гостей"'):e<t?b.setCustomValidity("Выберите меньшее число гостей"):b.setCustomValidity("")};T(),b.addEventListener("change",(()=>{T()})),C.addEventListener("change",(()=>{T()}));const z=e=>{E.value=e.target.value,x.value=e.target.value};x.addEventListener("click",z),E.addEventListener("click",z);const N={bungalow:"0",flat:"1000",house:"5000",palace:"10000"};q.addEventListener("click",(()=>{w.placeholder=N[q.value],w.min=N[q.value]})),L.addEventListener("input",(()=>{const e=L.value.length;e<30?L.setCustomValidity("Еще "+(30-e)+" симв."):e>100?L.setCustomValidity("Удалите лишние "+(e-100)+" симв."):L.setCustomValidity(""),L.reportValidity()}));const j=()=>{const e=1e6,t=w.value;t>e&&w.setCustomValidity("Выберите дешевле на "+(t-e)),/^[0-9]+$/.test(t)||w.setCustomValidity("Для ввода доступны только цифры"),t<w.min?w.setCustomValidity("Минимальная цена для данного типа жилья - "+N[q.value]):w.setCustomValidity(""),w.reportValidity()};w.addEventListener("input",(()=>{j()})),q.addEventListener("blur",(()=>{j()}));const R=1e4,U=1e4,I=5e4,M=5e4,O=document.querySelector(".map__filters"),P=O.querySelectorAll("select"),W=(e,t)=>{let o;return function(){const r=()=>{e.apply(this,arguments)};clearTimeout(o),o=setTimeout(r,t)}},H=e=>{let t=[];var o;e.some((e=>{if(t.length>=10)return!0;var o;o=e.offer,Array.from(P).every((e=>{const t=e.name.split("-")[1];return((e,t,o)=>"any"===o||("price"===t?((e,t)=>{switch(e){case"low":return t<=R;case"middle":return t>=U&&t<=I;case"high":return t>=M;default:return!1}})(o,e[t]):o===e[t].toString()))(o,t,e.value)}))&&(e=>{const t=O.querySelectorAll("input:checked"),o=Array.from(t);return!(e.features.length<o.length)&&(0===o.length||0===e.features.length||o.every((t=>e.features.includes(t.value))))})(e.offer)&&t.push(e)})),o=t,v.forEach((e=>{e.remove()})),g(o)};var $,B;$=e=>{S.classList.add("ad-form--disabled"),k.forEach((function(e){e.setAttribute("disabled",!0)})),m.on("load",(()=>{_.value=d})).setView({lat:u,lng:i},10),window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(m),h.on("moveend",(e=>{S.classList.remove("ad-form--disabled"),A.classList.remove("ad-form--disabled"),D.forEach((function(e){e.removeAttribute("disabled",!0)})),V.forEach((function(e){e.removeAttribute("disabled",!0)})),k.forEach((function(e){e.removeAttribute("disabled",!0)})),_.value=e.target.getLatLng().lat.toFixed(5)+", "+e.target.getLatLng().lng.toFixed(5)})),h.addTo(m),(e=>{const t=W((()=>H(e)),500);O.addEventListener("change",t)})(e),g(e)},B=()=>{t("Data not found error")},fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();t("Не удалось загрузить данные")})).then($).catch(B),F.addEventListener("submit",(e=>{var t,o,a;e.preventDefault(),t=()=>{(()=>{const e=r.cloneNode(!0);s(e)})(),F.reset(),A.reset(),f(),_.value=d},o=()=>(()=>{const e=n.cloneNode(!0);s(e)})(),a=new FormData(e.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:a}).then((e=>{e.ok?t():o()})).catch(o)})),o(772)})()})();
//# sourceMappingURL=main.bundle.js.map